[
    {
        "name": "SettingUpSharepointIP",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2015-01-01",
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "uri": "[variables('SettingUpSharepointIPUrl')]",
                "contentVersion": "1.0.0.0"
            },
            "parameters": {
                "location": {
                    "value": "[parameters('location')]"
                },
                "publicIpAddressName": {
                    "value": "[parameters('sppublicIPAddressName')]"
                },
                "publicIPAddressType": {
                    "value": "[variables('publicIPAddressType')]"
                },
                "dnsPrefix": {
                    "value": "[parameters('spDNSPrefix')]"
                },
                "publicIpRGName": {
                    "value": "[parameters('spPublicIPRGName')]"
                }
            }
        }
    },
    {
        "name": "ProvisioningSQLServerVM",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2015-01-01",
        "dependsOn": [
            "Microsoft.Resources/deployments/SettingUpStorageAccount",
            "Microsoft.Resources/deployments/CreatingNetworkInterfaces",
            "Microsoft.Resources/deployments/CreatingAvailabilitySets"
        ],
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "uri": "[variables('ProvisioningSQLUrl')]",
                "contentVersion": "1.0.0.0"
            },
            "parameters": {
                "location": {
                    "value": "[parameters('location')]"
                },
                "sqlVMName": {
                    "value": "[variables('sqlVMName')]"
                },
                "sqlVMSize": {
                    "value": "[parameters('sqlVMSize')]"
                },
                "sqlAvailabilitySetName": {
                    "value": "[variables('sqlAvailabilitySetName')]"
                },
                "adminUsername": {
                    "value": "[parameters('adminUsername')]"
                },
                "adminPassword": {
                    "value": "[parameters('adminPassword')]"
                },
                "storageAccountNamePrefix": {
                    "value": "[parameters('storageAccountNamePrefix')]"
                },
                "sqlDataDisk": {
                    "value": "[variables('sqlDataDisk')]"
                },
                "sqlLogDisk": {
                    "value": "[variables('sqlLogDisk')]"
                },
                "sqlNicName": {
                    "value": "[variables('sqlNicName')]"
                },
                "sqlPrepareModulesURL": {
                    "value": "[variables('sqlPrepareModulesURL')]"
                },
                "sqlPreparationFunction": {
                    "value": "[variables('sqlPreparationFunction')]"
                },
                "DNSServerAddress": {
                    "value": "[parameters('adNicIPAddress')]"
                }
            }
        }
    },
    {
        "name": "ProvisioningSharepointVM",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2015-01-01",
        "dependsOn": [
            "Microsoft.Resources/deployments/SettingUpStorageAccount",
            "Microsoft.Resources/deployments/CreatingNetworkInterfaces",
            "Microsoft.Resources/deployments/CreatingAvailabilitySets"
        ],
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "uri": "[variables('provisioningSharepointUrl')]",
                "contentVersion": "1.0.0.0"
            },
            "parameters": {
                "spVMName": {
                    "value": "[variables('spVMName')]"
                },
                "spPrepareModulesURL": {
                    "value": "[variables('spPrepareModulesURL')]"
                },
                "spPreparationFunction": {
                    "value": "[variables('spPreparationFunction')]"
                },
                "adminUsername": {
                    "value": "[parameters('adminUsername')]"
                },
                "adminPassword": {
                    "value": "[parameters('adminPassword')]"
                },
                "spVMSize": {
                    "value": "[parameters('spVMSize')]"
                },
                "spVersion": {
                    "value": "2013"
                },
                "spAvailabilitySetName": {
                    "value": "[variables('spAvailabilitySetName')]"
                },
                "spNicName": {
                    "value": "[variables('spNicName')]"
                },
                "storageAccountNamePrefix": {
                    "value": "[parameters('storageAccountNamePrefix')]"
                },
                "DNSServerAddress": {
                    "value": "[parameters('adNicIPAddress')]"
                }
            }
        }
    },
    {
        "name": "UpdatingDNStoPrimaryADVM",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2015-01-01",
        "dependsOn": [
            "Microsoft.Resources/deployments/ProvisioningADDomainController",
            "Microsoft.Resources/deployments/ProvisioningSQLServerVM",
            "Microsoft.Resources/deployments/ProvisioningSharepointVM"
        ],
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "uri": "[variables('vnetwithDNSTemplateUrl')]",
                "contentVersion": "1.0.0.0"
            },
            "parameters": {
                "location": {
                    "value": "[parameters('location')]"
                },
                "virtualNetworkName": {
                    "value": "[parameters('virtualNetworkName')]"
                },
                "virtualNetworkAddressRange": {
                    "value": "[parameters('virtualNetworkAddressRange')]"
                },
                "subnets": {
                    "value": "[variables('subnets')]"
                },
                "DNSServerAddress": {
                    "value": [
                        "[parameters('adNicIPAddress')]"
                    ]
                }
            }
        }
    },
    {
        "name": "ConfiguringSQLServerVM",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2015-01-01",
        "dependsOn": [
            "Microsoft.Resources/deployments/UpdatingDNStoPrimaryADVM"
        ],
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "uri": "[variables('configuringSQLUrl')]",
                "contentVersion": "1.0.0.0"
            },
            "parameters": {
                "location": {
                    "value": "[parameters('location')]"
                },
                "sqlVMName": {
                    "value": "[variables('sqlVMName')]"
                },
                "adminUsername": {
                    "value": "[parameters('adminUsername')]"
                },
                "adminPassword": {
                    "value": "[parameters('adminPassword')]"
                },
                "sqlConfgureModulesURL": {
                    "value": "[variables('sqlConfigureModulesURL')]"
                },
                "sqlConfigurationFunction": {
                    "value": "[variables('sqlConfigurationFunction')]"
                },
                "domainName": {
                    "value": "[parameters('domainName')]"
                },
                "sqlServerServiceAccountUserName": {
                    "value": "[parameters('sqlServerServiceAccountUserName')]"
                },
                "sharePointSetupUserAccountUserName": {
                    "value": "[parameters('sharePointSetupUserAccountUserName')]"
                },
                "sqlServerServiceAccountPassword": {
                    "value": "[parameters('sqlServerServiceAccountPassword')]"
                },
                "sharePointSetupUserAccountPassword": {
                    "value": "[parameters('sharePointSetupUserAccountPassword')]"
                }
            }
        }
    },
    {
        "name": "ConfiguringSharepointVM",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2015-01-01",
        "dependsOn": [
            "Microsoft.Resources/deployments/ConfiguringSQLServerVM"
        ],
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "uri": "[variables('configuringSharepointUrl')]",
                "contentVersion": "1.0.0.0"
            },
            "parameters": {
                "spVMName": {
                    "value": "[variables('spVMName')]"
                },
                "location": {
                    "value": "[parameters('location')]"
                },
                "spConfgureModulesURL": {
                    "value": "[variables('spConfigureModulesURL')]"
                },
                "spConfigurationFunction": {
                    "value": "[variables('spConfigurationFunction')]"
                },
                "domainName": {
                    "value": "[parameters('domainName')]"
                },
                "adminUsername": {
                    "value": "[parameters('adminUsername')]"
                },
                "sharePointSetupUserAccountUserName": {
                    "value": "[parameters('sharePointSetupUserAccountUserName')]"
                },
                "sharePointFarmAccountUserName": {
                    "value": "[parameters('sharePointFarmAccountUserName')]"
                },
                "configDatabaseName": {
                    "value": "[variables('configDatabaseName')]"
                },
                "administrationContentDatabaseName": {
                    "value": "[variables('administrationContentDatabaseName')]"
                },
                "sqlVMName": {
                    "value": "[variables('sqlVMName')]"
                },
                "fqdn": {
                    "value": "[variables('spFQDN')]"
                },
                "contentDatabaseName": {
                    "value": "[variables('contentDatabaseName')]"
                },
                "spSiteTemplateName": {
                    "value": "[parameters('spSiteTemplateName')]"
                },
                "adminPassword": {
                    "value": "[parameters('adminPassword')]"
                },
                "sharePointSetupUserAccountPassword": {
                    "value": "[parameters('sharePointSetupUserAccountPassword')]"
                },
                "sharePointFarmAccountPassword": {
                    "value": "[parameters('sharePointFarmAccountPassword')]"
                },
                "sharePointFarmPassphrasePassword": {
                    "value": "[parameters('sharePointFarmPassphrasePassword')]"
                },
                "sharepointFarmName": {
                    "value": "[parameters('sharepointFarmName')]"
                }
            }
        }
    }
]
